(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     32132,       1033]
NotebookOptionsPosition[     29639,        945]
NotebookOutlinePosition[     30018,        962]
CellTagsIndexPosition[     29975,        959]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["\<\
for readability of output (never use in assignments, only for print)\
\>", "Text",
 CellChangeTimes->{{3.670794561075774*^9, 3.6707945903314323`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"replPrint", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "1"}], "]"}], " ", "\[Rule]", " ", "h11"}], ",", " ", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "2"}], "]"}], " ", "\[Rule]", " ", "h12"}], ",", " ", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "3"}], "]"}], " ", "\[Rule]", " ", "h13"}], ",", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "2"}], "]"}], " ", "\[Rule]", " ", "h22"}], ",", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "3"}], "]"}], " ", "\[Rule]", " ", "h23"}]}], 
    "}"}]}], ";"}]], "Input"],

Cell["\<\
NOTE: since all of the equations are linear in the hij, everything below also \
holds if we put a dot on each hij (the derivatives)\
\>", "Text",
 CellChangeTimes->{{3.670794633766403*^9, 3.670794654210236*^9}}],

Cell["\<\
elimination rules due to symmetry and tracelessness (trivial):\
\>", "Text",
 CellChangeTimes->{{3.670794530932982*^9, 3.670794547092312*^9}, 
   3.670794661118067*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"replElim", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "1"}], "]"}], " ", "\[Rule]", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "2"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"3", ",", "1"}], "]"}], " ", "\[Rule]", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "3"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"3", ",", "2"}], "]"}], " ", "\[Rule]", " ", 
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "3"}], "]"}]}], ",", " ", 
     RowBox[{
      RowBox[{"h", "[", 
       RowBox[{"3", ",", "3"}], "]"}], " ", "\[Rule]", " ", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"h", "[", 
         RowBox[{"1", ",", "1"}], "]"}]}], " ", "-", " ", 
       RowBox[{"h", "[", 
        RowBox[{"2", ",", "2"}], "]"}]}]}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.670794053033517*^9, 3.67079410572465*^9}, {
  3.6707942400169373`*^9, 3.6707942423773737`*^9}}],

Cell["\<\
we are left with 5 unknowns and 3 equations from transversality:\
\>", "Text",
 CellChangeTimes->{{3.6707927060433064`*^9, 3.6707927371558123`*^9}, {
   3.670793635356184*^9, 3.670793676383902*^9}, 3.670794550524543*^9, {
   3.670794598268149*^9, 3.670794623844592*^9}, 3.670794668055509*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"constr", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"k1", " ", 
       RowBox[{"h", "[", 
        RowBox[{"1", ",", "1"}], "]"}]}], " ", "+", " ", 
      RowBox[{"k2", " ", 
       RowBox[{"h", "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], " ", "+", " ", 
      RowBox[{"k3", " ", 
       RowBox[{"h", "[", 
        RowBox[{"1", ",", "3"}], "]"}]}]}], " ", "\[Equal]", " ", "0"}], ",", 
    " ", 
    RowBox[{
     RowBox[{
      RowBox[{"k1", " ", 
       RowBox[{"h", "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], " ", "+", " ", 
      RowBox[{"k2", " ", 
       RowBox[{"h", "[", 
        RowBox[{"2", ",", "2"}], "]"}]}], " ", "+", " ", 
      RowBox[{"k3", " ", 
       RowBox[{"h", "[", 
        RowBox[{"2", ",", "3"}], "]"}]}]}], " ", "\[Equal]", " ", "0"}], ",", 
    " ", 
    RowBox[{
     RowBox[{
      RowBox[{"k1", " ", 
       RowBox[{"h", "[", 
        RowBox[{"1", ",", "3"}], "]"}]}], " ", "+", " ", 
      RowBox[{"k2", " ", 
       RowBox[{"h", "[", 
        RowBox[{"2", ",", "3"}], "]"}]}], " ", "-", " ", 
      RowBox[{"k3", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"h", "[", 
          RowBox[{"1", ",", "1"}], "]"}], " ", "+", " ", 
         RowBox[{"h", "[", 
          RowBox[{"2", ",", "2"}], "]"}]}], ")"}]}]}], " ", "\[Equal]", " ", 
     "0"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.670792408334714*^9, 3.6707924939156523`*^9}, {
  3.670793291340014*^9, 3.670793326681386*^9}, {3.670793759882434*^9, 
  3.670793788385972*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"k1", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "1"}], "]"}]}], "+", 
     RowBox[{"k2", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "2"}], "]"}]}], "+", 
     RowBox[{"k3", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "3"}], "]"}]}]}], "\[Equal]", "0"}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"k1", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "2"}], "]"}]}], "+", 
     RowBox[{"k2", " ", 
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "2"}], "]"}]}], "+", 
     RowBox[{"k3", " ", 
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "3"}], "]"}]}]}], "\[Equal]", "0"}], ",", 
   RowBox[{
    RowBox[{
     RowBox[{"k1", " ", 
      RowBox[{"h", "[", 
       RowBox[{"1", ",", "3"}], "]"}]}], "-", 
     RowBox[{"k3", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{"1", ",", "1"}], "]"}], "+", 
        RowBox[{"h", "[", 
         RowBox[{"2", ",", "2"}], "]"}]}], ")"}]}], "+", 
     RowBox[{"k2", " ", 
      RowBox[{"h", "[", 
       RowBox[{"2", ",", "3"}], "]"}]}]}], "\[Equal]", "0"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{
  3.6707925054010057`*^9, 3.670793228451789*^9, 3.670793335733694*^9, {
   3.670793790133214*^9, 3.6707938053012943`*^9}, 3.670793846255069*^9, 
   3.670793942285123*^9}]
}, Open  ]],

Cell["\<\
up to a constant factor this is what we want to compute eventually\
\>", "Text",
 CellChangeTimes->{{3.67079467482137*^9, 3.670794682554463*^9}, {
  3.670794723161892*^9, 3.670794748705209*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rhogw", " ", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"h", "[", 
       RowBox[{"i", ",", "j"}], "]"}], "2"], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.670794173849175*^9, 3.670794185739087*^9}, {
   3.670794489287777*^9, 3.670794504495721*^9}, 3.670794719895282*^9}],

Cell["\<\
we should end up with only 2 independent hij. however, we can\
\[CloseCurlyQuote]t single out two that work for all k. we have to \
distinguish 3 cases:\
\>", "Text",
 CellChangeTimes->{{3.670794734681385*^9, 3.670794786008341*^9}}],

Cell[CellGroupData[{

Cell["if k3 != 0 (compute: h11, h12)", "Subsection",
 CellChangeTimes->{
  3.670793471514966*^9, {3.670794465013084*^9, 3.670794466643923*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"case1", " ", "=", " ", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{"constr", ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{"1", ",", "3"}], "]"}], ",", " ", 
        RowBox[{"h", "[", 
         RowBox[{"2", ",", "2"}], "]"}], ",", " ", 
        RowBox[{"h", "[", 
         RowBox[{"2", ",", "3"}], "]"}]}], "}"}]}], "]"}], " ", "//", " ", 
    "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"case1", " ", "/.", " ", "replPrint"}]}], "Input",
 CellChangeTimes->{{3.6707925352858152`*^9, 3.670792543367549*^9}, {
  3.670792581037059*^9, 3.670792630827075*^9}, {3.670792838076281*^9, 
  3.670792839499866*^9}, {3.6707930005286007`*^9, 3.670793008919458*^9}, {
  3.670793794745051*^9, 3.670793801168641*^9}, {3.670793945489717*^9, 
  3.670793991298134*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"h13", "\[Rule]", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{
        RowBox[{"h11", " ", "k1"}], "+", 
        RowBox[{"h12", " ", "k2"}]}], "k3"]}]}], ",", 
    RowBox[{"h22", "\[Rule]", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{
        RowBox[{"h11", " ", 
         SuperscriptBox["k1", "2"]}], "+", 
        RowBox[{"2", " ", "h12", " ", "k1", " ", "k2"}], "+", 
        RowBox[{"h11", " ", 
         SuperscriptBox["k3", "2"]}]}], 
       RowBox[{
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}]}], ",", 
    RowBox[{"h23", "\[Rule]", 
     FractionBox[
      RowBox[{
       RowBox[{"h11", " ", 
        SuperscriptBox["k1", "2"], " ", "k2"}], "+", 
       RowBox[{"h11", " ", "k2", " ", 
        SuperscriptBox["k3", "2"]}], "+", 
       RowBox[{"h12", " ", "k1", " ", 
        RowBox[{"(", 
         RowBox[{
          SuperscriptBox["k2", "2"], "-", 
          SuperscriptBox["k3", "2"]}], ")"}]}]}], 
      RowBox[{"k3", " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["k2", "2"], "+", 
         SuperscriptBox["k3", "2"]}], ")"}]}]]}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{3.670793991643409*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"rhogw", " ", "/.", " ", "replElim"}], ")"}], " ", "/.", " ", 
     "case1"}], ")"}], " ", "/.", " ", "replPrint"}], " ", "//", " ", 
  "FullSimplify"}]], "Input",
 CellChangeTimes->{{3.670794029196763*^9, 3.670794048809183*^9}, {
  3.6707941103717833`*^9, 3.670794149026458*^9}, {3.670794183036056*^9, 
  3.670794188401238*^9}, {3.670794222776881*^9, 3.670794257055831*^9}, {
  3.670794510935033*^9, 3.6707945112146463`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  FractionBox[
   RowBox[{"2", " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["k1", "2"], "+", 
      SuperscriptBox["k2", "2"], "+", 
      SuperscriptBox["k3", "2"]}], ")"}], " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{
         RowBox[{"h11", " ", "k1"}], "+", 
         RowBox[{"h12", " ", "k2"}]}], ")"}], "2"], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["h11", "2"], "+", 
         SuperscriptBox["h12", "2"]}], ")"}], " ", 
       SuperscriptBox["k3", "2"]}]}], ")"}]}], 
   RowBox[{
    SuperscriptBox["k3", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["k2", "2"], "+", 
      SuperscriptBox["k3", "2"]}], ")"}]}]], "}"}]], "Output",
 CellChangeTimes->{{3.670794110893042*^9, 3.6707941495487337`*^9}, 
   3.6707941890540743`*^9, {3.6707942492450323`*^9, 3.6707942575458508`*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
if k3 = 0, k2 != 0 (compute: h11, h13)\
\>", "Subsection",
 CellChangeTimes->{
  3.6707934777190247`*^9, {3.6707944405979633`*^9, 3.6707944594278603`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"case2", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{"constr", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"h", "[", 
          RowBox[{"1", ",", "2"}], "]"}], ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"2", ",", "3"}], "]"}], ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"2", ",", "2"}], "]"}]}], "}"}]}], "]"}], " ", "/.", " ", 
     RowBox[{"{", 
      RowBox[{"k3", "\[Rule]", " ", "0"}], "}"}]}], "//", " ", "Simplify"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{"case2", " ", "/.", " ", "replPrint"}]}], "Input",
 CellChangeTimes->{{3.67079279328753*^9, 3.67079294864776*^9}, {
  3.670793021217956*^9, 3.67079303930772*^9}, {3.6707938148559847`*^9, 
  3.6707938189921*^9}, {3.6707939733393917`*^9, 3.670793998196437*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"h12", "\[Rule]", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"h11", " ", "k1"}], "k2"]}]}], ",", 
    RowBox[{"h23", "\[Rule]", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"h13", " ", "k1"}], "k2"]}]}], ",", 
    RowBox[{"h22", "\[Rule]", 
     FractionBox[
      RowBox[{"h11", " ", 
       SuperscriptBox["k1", "2"]}], 
      SuperscriptBox["k2", "2"]]}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{3.670793998993907*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"rhogw", " ", "/.", " ", "replElim"}], ")"}], " ", "/.", " ", 
       
       RowBox[{"{", 
        RowBox[{"k3", " ", "\[Rule]", " ", "0"}], "}"}]}], ")"}], " ", "/.", 
     " ", "case2"}], ")"}], " ", "/.", " ", "replPrint"}], " ", "//", " ", 
  "FullSimplify"}]], "Input",
 CellChangeTimes->{{3.6707941921523123`*^9, 3.670794209176869*^9}, {
   3.6707942664478397`*^9, 3.670794284423154*^9}, 3.670794515855507*^9}],

Cell[BoxData[
 RowBox[{"{", 
  FractionBox[
   RowBox[{"2", " ", 
    RowBox[{"(", 
     RowBox[{
      SuperscriptBox["k1", "2"], "+", 
      SuperscriptBox["k2", "2"]}], ")"}], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox["h13", "2"], " ", 
       SuperscriptBox["k2", "2"]}], "+", 
      RowBox[{
       SuperscriptBox["h11", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["k1", "2"], "+", 
         SuperscriptBox["k2", "2"]}], ")"}]}]}], ")"}]}], 
   SuperscriptBox["k2", "4"]], "}"}]], "Output",
 CellChangeTimes->{
  3.670794209807046*^9, {3.670794280916176*^9, 3.670794284767972*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
if k3 = k2 = 0, k1 != 0 (compute: h22, h23)\
\>", "Subsection",
 CellChangeTimes->{
  3.6707934828691998`*^9, {3.670794416312169*^9, 3.670794449284306*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"case3", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Solve", "[", 
      RowBox[{"constr", ",", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"h", "[", 
          RowBox[{"1", ",", "1"}], "]"}], ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"1", ",", "2"}], "]"}], ",", " ", 
         RowBox[{"h", "[", 
          RowBox[{"1", ",", "3"}], "]"}]}], "}"}]}], "]"}], "/.", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k2", "\[Rule]", " ", "0"}], ",", " ", 
       RowBox[{"k3", "\[Rule]", " ", "0"}]}], "}"}]}], "//", " ", 
    "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"case3", " ", "/.", " ", "replPrint"}]}], "Input",
 CellChangeTimes->{{3.670793062720467*^9, 3.670793094097837*^9}, {
  3.670793128700981*^9, 3.6707931688721457`*^9}, {3.670793206791643*^9, 
  3.670793232526965*^9}, {3.670793821896265*^9, 3.670793881267445*^9}, {
  3.670793977763228*^9, 3.670794012234108*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"h11", "\[Rule]", "0"}], ",", 
    RowBox[{"h12", "\[Rule]", "0"}], ",", 
    RowBox[{"h13", "\[Rule]", "0"}]}], "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.670794005677917*^9, 3.670794012529945*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"rhogw", " ", "/.", " ", "replElim"}], ")"}], " ", "/.", " ", 
       
       RowBox[{"{", 
        RowBox[{
         RowBox[{"k2", " ", "\[Rule]", " ", "0"}], ",", " ", 
         RowBox[{"k3", " ", "\[Rule]", " ", "0"}]}], "}"}]}], ")"}], " ", "/.",
      " ", "case3"}], ")"}], " ", "/.", " ", "replPrint"}], " ", "//", " ", 
  "FullSimplify"}]], "Input",
 CellChangeTimes->{{3.6707942935764513`*^9, 3.670794300326769*^9}, 
   3.67079452019147*^9, {3.670795057014213*^9, 3.670795057966276*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"2", " ", 
   RowBox[{"(", 
    RowBox[{
     SuperscriptBox["h22", "2"], "+", 
     SuperscriptBox["h23", "2"]}], ")"}]}], "}"}]], "Output",
 CellChangeTimes->{3.670794300986557*^9}]
}, Open  ]],

Cell["\<\
hence we have to evolve two additional fields on the whole grid:
field 1: h11 where k3!= 0
\th22 where k2=k3=0, k1!=0
field 2: h12 where k3!=0
\th13 where k3=0, k2!=0
\th23 where k3=k2=0, k1!=0\
\>", "Text",
 CellChangeTimes->{{3.670795015221246*^9, 3.6707951356474323`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "computing traceless transverse part of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["S", "ij"], TraditionalForm]],
  FormatType->"TraditionalForm"]
}], "Section",
 CellChangeTimes->{{3.671822881288925*^9, 3.671822898778462*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"k", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"k1", ",", " ", "k2", ",", " ", "k3"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"S", " ", "=", " ", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s11", ",", "s12", ",", "s13"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s12", ",", "s22", ",", "s23"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"s13", ",", "s23", ",", "s33"}], "}"}]}], 
   "}"}]}], "\[IndentingNewLine]", 
 RowBox[{"P", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"KroneckerDelta", "[", 
      RowBox[{"i", ",", "j"}], "]"}], " ", "-", " ", 
     FractionBox[
      RowBox[{
       RowBox[{"k", "[", 
        RowBox[{"[", "i", "]"}], "]"}], " ", 
       RowBox[{"k", "[", 
        RowBox[{"[", "j", "]"}], "]"}], " "}], 
      RowBox[{"k", ".", "k"}]]}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Ptest", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"k", ".", "k"}], " ", "-", " ", 
          SuperscriptBox["k1", "2"]}], ",", " ", 
         RowBox[{
          RowBox[{"-", "k1"}], " ", "k2"}], ",", 
         RowBox[{
          RowBox[{"-", "k1"}], " ", "k3"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "k1"}], " ", "k2"}], ",", " ", 
         RowBox[{
          RowBox[{"k", ".", "k"}], " ", "-", " ", 
          SuperscriptBox["k2", "2"]}], ",", " ", 
         RowBox[{
          RowBox[{"-", "k2"}], " ", "k3"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "k1"}], " ", "k3"}], ",", " ", 
         RowBox[{
          RowBox[{"-", "k2"}], " ", "k3"}], ",", " ", 
         RowBox[{
          RowBox[{"k", ".", "k"}], " ", "-", " ", 
          SuperscriptBox["k3", "2"]}]}], "}"}]}], "}"}], " ", "/", " ", 
     RowBox[{"(", 
      RowBox[{"k", ".", "k"}], ")"}]}], " ", "//", "Simplify"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"P", " ", "-", " ", "Ptest"}], " ", "//", "Simplify"}]}], "Input",
 CellChangeTimes->{{3.671823831507477*^9, 3.67182399810497*^9}, {
  3.6718240408902197`*^9, 3.6718240637676563`*^9}, {3.671824554128632*^9, 
  3.6718245542321577`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"s11", ",", "s12", ",", "s13"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"s12", ",", "s22", ",", "s23"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"s13", ",", "s23", ",", "s33"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6718238614074383`*^9, {3.671823936601303*^9, 3.671823998655654*^9}, {
   3.671824044048835*^9, 3.6718240640852127`*^9}, 3.671824570871251*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "-", 
      FractionBox[
       SuperscriptBox["k1", "2"], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k1", " ", "k2"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k1", " ", "k3"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k1", " ", "k2"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"1", "-", 
      FractionBox[
       SuperscriptBox["k2", "2"], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k2", " ", "k3"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k1", " ", "k3"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"-", 
      FractionBox[
       RowBox[{"k2", " ", "k3"}], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}], ",", 
     RowBox[{"1", "-", 
      FractionBox[
       SuperscriptBox["k3", "2"], 
       RowBox[{
        SuperscriptBox["k1", "2"], "+", 
        SuperscriptBox["k2", "2"], "+", 
        SuperscriptBox["k3", "2"]}]]}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6718238614074383`*^9, {3.671823936601303*^9, 3.671823998655654*^9}, {
   3.671824044048835*^9, 3.6718240640852127`*^9}, 3.6718245708738747`*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.6718238614074383`*^9, {3.671823936601303*^9, 3.671823998655654*^9}, {
   3.671824044048835*^9, 3.6718240640852127`*^9}, 3.671824570875238*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["direct way", "Subsection",
 CellChangeTimes->{{3.671824112663886*^9, 3.671824116597217*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"STT", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "k"}], "]"}], "]"}], " ", 
          RowBox[{"S", "[", 
           RowBox[{"[", 
            RowBox[{"k", ",", "l"}], "]"}], "]"}], " ", 
          RowBox[{"P", "[", 
           RowBox[{"[", 
            RowBox[{"l", ",", "j"}], "]"}], "]"}]}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "3"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"l", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}], " ", "-", " ", 
     RowBox[{
      FractionBox["1", "2"], " ", "P", " ", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"P", "[", 
          RowBox[{"[", 
           RowBox[{"l", ",", "m"}], "]"}], "]"}], " ", 
         RowBox[{"S", "[", 
          RowBox[{"[", 
           RowBox[{"l", ",", "m"}], "]"}], "]"}]}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"l", ",", "1", ",", "3"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"m", ",", "1", ",", "3"}], "}"}]}], "]"}]}]}], " ", "//", 
    " ", "FullSimplify"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671823295835565*^9, 3.6718233676956787`*^9}, {
   3.671823407189466*^9, 3.671823464668523*^9}, 3.671823502512073*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["indirect, as in code", "Subsection",
 CellChangeTimes->{{3.6718241368959723`*^9, 3.6718241413441353`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"f", " ", "=", " ", 
   RowBox[{"k", " ", "/", " ", 
    RowBox[{"(", 
     RowBox[{"k", ".", "k"}], ")"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671823590582671*^9, 3.6718236296770983`*^9}, {
   3.671823773863676*^9, 3.671823782046659*^9}, {3.671824081159912*^9, 
   3.671824099001189*^9}, 3.6718243331844893`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ks", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"k", "[", 
         RowBox[{"[", "m", "]"}], "]"}], " ", 
        RowBox[{"S", "[", 
         RowBox[{"[", 
          RowBox[{"m", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", "1", ",", "3"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671824144175144*^9, 3.6718241982245817`*^9}, {
  3.671824328946871*^9, 3.671824330746773*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"sp", " ", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      FractionBox[
       RowBox[{
        RowBox[{"k", "[", 
         RowBox[{"[", "l", "]"}], "]"}], " ", 
        RowBox[{"k", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}], 
       RowBox[{"(", 
        RowBox[{"k", ".", "k"}], ")"}]], " ", 
      RowBox[{"S", "[", 
       RowBox[{"[", 
        RowBox[{"l", ",", "m"}], "]"}], "]"}]}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"l", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6718235453305187`*^9, 3.671823558999914*^9}, {
  3.671823646163354*^9, 3.671823678236216*^9}, {3.671824232211576*^9, 
  3.6718242735862103`*^9}, {3.671824325394163*^9, 3.671824327313487*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"s", " ", "=", " ", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{"S", "[", 
      RowBox[{"[", 
       RowBox[{"m", ",", "m"}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.671823687384165*^9, 3.6718237037671537`*^9}, {
  3.6718243220813513`*^9, 3.671824323815694*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"s1", " ", "=", " ", 
   RowBox[{
    RowBox[{"sp", " ", "+", " ", "s"}], " ", "//", " ", "Simplify"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"s2", " ", "=", " ", 
   RowBox[{
    RowBox[{"sp", " ", "-", " ", "s"}], " ", "//", " ", "Simplify"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.671824309067902*^9, 3.671824357107192*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"S11test", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"S", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "1"}], "]"}], "]"}], " ", "-", " ", 
     RowBox[{"2", " ", 
      RowBox[{"f", "[", 
       RowBox[{"[", "1", "]"}], "]"}], " ", 
      RowBox[{"ks", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], " ", "+", " ", 
     RowBox[{
      FractionBox["1", "2"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", 
         RowBox[{"k", "[", 
          RowBox[{"[", "1", "]"}], "]"}], " ", "s1"}], " ", "+", " ", "s2"}], 
       ")"}]}]}], " ", "//", " ", "FullSimplify"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6718237180540953`*^9, 3.671823719069503*^9}, {
  3.67182436115917*^9, 3.671824435743271*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"STTtest", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"S", "[", 
       RowBox[{"[", 
        RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "-", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "i", "]"}], "]"}], " ", 
       RowBox[{"ks", "[", 
        RowBox[{"[", "j", "]"}], "]"}]}], " ", "-", " ", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "j", "]"}], "]"}], " ", 
       RowBox[{"ks", "[", 
        RowBox[{"[", "i", "]"}], "]"}]}], " ", "+", " ", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"f", "[", 
        RowBox[{"[", "i", "]"}], "]"}], " ", 
       RowBox[{"k", "[", 
        RowBox[{"[", "j", "]"}], "]"}], " ", "s1"}], " ", "+", " ", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"KroneckerDelta", "[", 
        RowBox[{"i", ",", "j"}], "]"}], " ", "s2"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", "3"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.6718245944214497`*^9, 3.671824670050102*^9}, 
   3.671824731165204*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"STTtest", " ", "-", " ", "STT"}], " ", "//", 
  "FullSimplify"}]], "Input",
 CellChangeTimes->{{3.671824437401516*^9, 3.671824445960413*^9}, {
  3.671824674007757*^9, 3.671824677639748*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.671824446203998*^9, 3.671824578920267*^9, 
  3.671824679218567*^9, 3.671824738891844*^9}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1069, 851},
WindowMargins->{{Automatic, 161}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 23, \
2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 160, 3, 26, "Text"],
Cell[720, 25, 699, 20, 27, "Input"],
Cell[1422, 47, 221, 4, 26, "Text"],
Cell[1646, 53, 178, 4, 26, "Text"],
Cell[1827, 59, 1060, 30, 27, "Input"],
Cell[2890, 91, 302, 5, 26, "Text"],
Cell[CellGroupData[{
Cell[3217, 100, 1554, 46, 43, "Input"],
Cell[4774, 148, 1381, 44, 27, "Output"]
}, Open  ]],
Cell[6170, 195, 204, 4, 26, "Text"],
Cell[6377, 201, 498, 13, 33, "Input"],
Cell[6878, 216, 242, 5, 26, "Text"],
Cell[CellGroupData[{
Cell[7145, 225, 143, 2, 34, "Subsection"],
Cell[CellGroupData[{
Cell[7313, 231, 852, 20, 43, "Input"],
Cell[8168, 253, 1260, 39, 57, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9465, 297, 524, 12, 27, "Input"],
Cell[9992, 311, 941, 29, 57, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[10982, 346, 165, 4, 34, "Subsection"],
Cell[CellGroupData[{
Cell[11172, 354, 853, 21, 43, "Input"],
Cell[12028, 377, 516, 17, 50, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12581, 399, 553, 15, 27, "Input"],
Cell[13137, 416, 649, 21, 52, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[13835, 443, 166, 4, 34, "Subsection"],
Cell[CellGroupData[{
Cell[14026, 451, 975, 24, 43, "Input"],
Cell[15004, 477, 272, 7, 27, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[15313, 489, 632, 17, 27, "Input"],
Cell[15948, 508, 222, 7, 33, "Output"]
}, Open  ]],
Cell[16185, 518, 285, 8, 101, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[16507, 531, 246, 7, 70, "Section"],
Cell[CellGroupData[{
Cell[16778, 542, 2469, 74, 115, "Input"],
Cell[19250, 618, 445, 11, 27, "Output"],
Cell[19698, 631, 2307, 74, 93, "Output"],
Cell[22008, 707, 427, 11, 27, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22472, 723, 98, 1, 35, "Subsection"],
Cell[22573, 726, 1581, 44, 62, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[24191, 775, 112, 1, 34, "Subsection"],
Cell[24306, 778, 354, 8, 27, "Input"],
Cell[24663, 788, 630, 18, 27, "Input"],
Cell[25296, 808, 842, 23, 49, "Input"],
Cell[26141, 833, 401, 11, 27, "Input"],
Cell[26545, 846, 387, 11, 43, "Input"],
Cell[26935, 859, 840, 24, 46, "Input"],
Cell[27778, 885, 1197, 34, 46, "Input"],
Cell[CellGroupData[{
Cell[29000, 923, 225, 5, 27, "Input"],
Cell[29228, 930, 371, 10, 27, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
